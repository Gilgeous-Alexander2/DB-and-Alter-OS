## Отчет по лабораторной работе №2

### 1) Утилиты резервного копирования

*Логический бэкап (pg_dump)* - это резервная копия, созданная на уровне SQL-запросов. \
Это означает, что вместо копирования физических файлов базы данных, \
логический бэкап генерирует набор SQL-команд, которые позволяют\
воссоздать структуру и содержимое базы данных.

Сценарии применения\
•	Перенос данных между различными версиями PostgreSQL или платформами.\
•	Резервное копирование одной базы данных (или её части, например, таблиц или схем).\
•	Создание выборочной копии (например, только схемы или только данные).\
•	Гибкость восстановления: можно восстановить отдельные объекты или изменить порядок восстановления.

Преимущества\
•	Подходит для переноса между различными версиями PostgreSQL или операционными системами.\
•	Возможность выборочного восстановления объектов.

*Физический бэкап (pd_basebackup)* — это метод резервного копирования,\
при котором производится прямое копирование бинарных файлов базы данных,\
включая файлы данных, журналы и индексные файлы. \
Это создание полной двоичной копии всех файлов, относящихся к кластеру базы данных.

Сценарии применения\
•	Настройка репликации: создание резервной копии для standby-сервера.\
•	Быстрое восстановление системы после сбоя.\
•	Point-In-Time Recovery (PITR): восстановление до определённой точки времени при наличии WAL-журналов.

Преимущества\
•	Полная копия кластера PostgreSQL, включая все базы данных.\
•	Подходит для быстрого восстановления.\
•	Возможность восстановления до любой точки времени при наличии архивированных WAL-журналов.

### 2) Создание резервной копии

Выполняем бэкапы бд:

![2](https://github.com/user-attachments/assets/446d8a7b-9e91-4b89-a9ec-43a74c64b800)

Разница между командами заключается в формате сохраняемой базы данных. \
По умолчанию бэкап базы сохраняется в формате plain text (набор sql команд). \
Не поддержиает выборочное восстановление.

-Fc – кастомный формат PostgreSQL, позволяет выборочно восстанавливать объекты,\
только схемы или данные например. Поддерживает восстановление с помощью pg_restore.

-Ft – формат архива tar, удобен для переносимости, так как создаёт единый файл,\
который можно легко переместить. Поддерживает восстановление с помощью pg_restore.

Доп. флаги:
•	-s: Сохраняет только схему базы данных (без данных).\
•	-a: Сохраняет только данные (без схемы).\
•	-t: Сохраняет данные только из указанной таблицы.\
•	-n: Сохраняет объекты из указанной схемы.

### 3) Частичное (выборочное) резервное копирование

Сохраняем схему test_schema из dbalex:

![3](https://github.com/user-attachments/assets/54d66f9c-0ced-4bcc-a709-b4d089da1fd0)

Сохраняем две таблицы из схемы public в базе dbalex:

![3 1](https://github.com/user-attachments/assets/02ac44a8-a406-4feb-9695-b9139095cbe1)

![3 2](https://github.com/user-attachments/assets/1b6be1ba-ee62-4580-950d-ed8690b1d647)

### 4) Восстановление из резервной копии

Создаем бд dbalex_backup:

![4](https://github.com/user-attachments/assets/076c61d8-67ed-4078-a326-3378e476e52a

Восстанавливаем базу данных из файла dbalex_backup.sql:

![4 1](https://github.com/user-attachments/assets/9c91144c-e40a-48ba-8f29-d476ca50cdc2)
![4 2](https://github.com/user-attachments/assets/8a484d8a-3139-4b68-920f-bd3269a2b1af)
![4 3](https://github.com/user-attachments/assets/a85ce918-79cf-47ed-97e3-8d7d5bf47570)

Выводим таблицы из базы данных dbalex, чтобы сравнить с бэкапом:

![4 5](https://github.com/user-attachments/assets/96bfae81-31ee-41b9-83cf-551a9787dac6)

Таблицы из базы данных dbalex_backup:

![4 4](https://github.com/user-attachments/assets/1978ae74-64c4-4616-bd01-0e89163d8751)


### 5) Автоматизация бэкапов с помощью cron

Создание скрипта для автоматического бэкапа бд dbalex.\
Скрипт ниже создает бэкап базы данных dbalex, и располагает файл с бэкапом \
в кастомном формате в директории /home/user1/backup-scripts. \
Также, бэкапы что хронятся дольше 7и дней автоматически удаляются. Это называется ротация.

![5 2](https://github.com/user-attachments/assets/e29a3491-2dc6-4728-b4c5-99181e37d23d)

Настройка на автовыполнение скрипта каждую минуту:

![5 3](https://github.com/user-attachments/assets/e4bbfc77-66b6-4894-94d1-7d9c5dcbab33)

### 6) Мониторинг состояния системы

Выполняем команду top:

![6](https://github.com/user-attachments/assets/7af46c13-36f5-464c-9a38-29fe8e49343e)

•	PID: Идентификатор процесса PostgreSQL.\
•	USER: Пользователь, под которым запущен процесс (обычно postgres).\
•	%CPU: Процент использования CPU процессом.\
•	%MEM: Процент использования оперативной памяти процессом.\
•	TIME+: Общее время работы процесса на CPU.\
•	COMMAND: Имя команды или процесса (например, postgres: writer process).

### 7) Мониторинг PostgreSQL

Просмотр активных процессов:

![7](https://github.com/user-attachments/assets/f836d354-52f4-4c78-a32c-90f729c16627)

Завершение зависшего процесса:\
SELECT pg_terminate_backend(<pid>);

### 8) Логирование и анализ логов 

Вывод системных логов:

![8](https://github.com/user-attachments/assets/93c284ba-8cc3-4320-b24d-4a0511c05ec3)





