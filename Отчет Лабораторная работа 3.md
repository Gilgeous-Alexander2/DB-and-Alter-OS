## Отчет по лабораторной работе №3

### 1) Утилиты резервного копирования

##### shared_buffers\
Назначение: Кэширование часто используемых данных для сокращения обращений к диску.\
Значение: 1 ГБ (25% от общего объёма памяти).\
Обоснование:

Превышение 25% ОЗУ вызывает конкуренцию с кэшем ОС

Оптимально для хранения рабочих наборов данных небольших БД

###work_mem\
Назначение: Память для операций сортировки, хэширования и соединений.\
Значение: 10–16 МБ (рекомендация для 100 подключений).\
Обоснование:

Значения >20 МБ при 100 подключениях могут исчерпать память

Признак недостатка: Sort Method: external merge Disk в плане запроса


###maintenance_work_mem\
Назначение: Память для операций обслуживания (VACUUM, индексация).\
Значение: 256 МБ (6% от ОЗУ).\
Обоснование:

Безопасный объём для ограниченной памяти

Ускоряет восстановление дампов в 2-4 раза


###effective_cache_size\
Назначение: Оценка общего кэша (ОС + PostgreSQL).\
Значение: 3 ГБ (75% от ОЗУ).\
Обоснование:

Помогает планировщику выбирать индексные сканы

Не влияет на реальное потребление памяти


### 2) Создание резервной копии

Выполняем бэкапы бд:

![2](https://github.com/user-attachments/assets/446d8a7b-9e91-4b89-a9ec-43a74c64b800)

Разница между командами заключается в формате сохраняемой базы данных. \
По умолчанию бэкап базы сохраняется в формате plain text (набор sql команд). \
Не поддержиает выборочное восстановление.

-Fc – кастомный формат PostgreSQL, позволяет выборочно восстанавливать объекты,\
только схемы или данные например. Поддерживает восстановление с помощью pg_restore.

-Ft – формат архива tar, удобен для переносимости, так как создаёт единый файл,\
который можно легко переместить. Поддерживает восстановление с помощью pg_restore.

Доп. флаги:
•	-s: Сохраняет только схему базы данных (без данных).\
•	-a: Сохраняет только данные (без схемы).\
•	-t: Сохраняет данные только из указанной таблицы.\
•	-n: Сохраняет объекты из указанной схемы.

### 3) Частичное (выборочное) резервное копирование

Сохраняем схему test_schema из dbalex:

![3](https://github.com/user-attachments/assets/54d66f9c-0ced-4bcc-a709-b4d089da1fd0)

Сохраняем две таблицы из схемы public в базе dbalex:

![3 1](https://github.com/user-attachments/assets/02ac44a8-a406-4feb-9695-b9139095cbe1)

![3 2](https://github.com/user-attachments/assets/1b6be1ba-ee62-4580-950d-ed8690b1d647)

### 4) Восстановление из резервной копии

Создаем бд dbalex_backup:

![4](https://github.com/user-attachments/assets/076c61d8-67ed-4078-a326-3378e476e52a

Восстанавливаем базу данных из файла dbalex_backup.sql:



Выводим таблицы из базы данных dbalex, чтобы сравнить с бэкапом:


Таблицы из базы данных dbalex_backup:



### 5) Автоматизация бэкапов с помощью cron

Создание скрипта для автоматического бэкапа бд dbalex.\
Скрипт ниже создает бэкап базы данных dbalex, и располагает файл с бэкапом \
в кастомном формате в директории /home/user1/backup-scripts. \
Также, бэкапы что хронятся дольше 7и дней автоматически удаляются. Это называется ротация.


Настройка на автовыполнение скрипта каждую минуту:



